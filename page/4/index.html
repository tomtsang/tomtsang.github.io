<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="Tom Tsang&apos;s Blogs">
<meta property="og:type" content="website">
<meta property="og:title" content="tomtsang">
<meta property="og:url" content="http://tomtsang.github.io/page/4/index.html">
<meta property="og:site_name" content="tomtsang">
<meta property="og:description" content="Tom Tsang&apos;s Blogs">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="tomtsang">
<meta name="twitter:description" content="Tom Tsang&apos;s Blogs">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"right","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://tomtsang.github.io/page/4/"/>





  <title> tomtsang </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?a64f4d6f03263e55ef37aad3b6e85a36";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>










  
  
    
  

  <div class="container one-collumn sidebar-position-right 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">tomtsang</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
    
      <p class="site-subtitle">AI,BIGDATA,CODE,DATA,E,FINTECH ...</p>
    
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-sitemap">
          <a href="/sitemap.xml" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br />
            
            Sitemap
          </a>
        </li>
      
        
        <li class="menu-item menu-item-something">
          <a href="/something" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            有料
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-commonweal">
          <a href="/404.html" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br />
            
            公益404
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://tomtsang.github.io/2016/11/19/git-2/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Tom Tsang">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.png">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="tomtsang">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="tomtsang" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/11/19/git-2/" itemprop="url">
                  git系列之使用
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-11-19T18:56:10+08:00">
                2016-11-19
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/git/" itemprop="url" rel="index">
                    <span itemprop="name">git</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/11/19/git-2/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/11/19/git-2/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="git-reset-–hard-commit-id"><a href="#git-reset-–hard-commit-id" class="headerlink" title="git reset –hard commit_id"></a>git reset –hard commit_id</h2><p>Git允许我们在版本的历史之间穿梭，使用命令git reset –hard commit_id</p>
<h2 id="去除对-已添加的文件或文件夹-的跟踪"><a href="#去除对-已添加的文件或文件夹-的跟踪" class="headerlink" title="去除对　已添加的文件或文件夹　的跟踪"></a>去除对　已添加的文件或文件夹　的跟踪</h2><pre><code>git rm -r --cached -- .idea/
</code></pre><p>这样呢，文件夹里 .idea/　的修改，git都不跟踪了。</p>
<pre><code>git rm -r --cached -- node_modules/
</code></pre>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://tomtsang.github.io/2016/11/19/git-1git系列之从外部复制一个.git文件，如何使用/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Tom Tsang">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.png">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="tomtsang">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="tomtsang" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/11/19/git-1git系列之从外部复制一个.git文件，如何使用/" itemprop="url">
                  git系列之从外部复制一个.git文件，如何使用
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-11-19T18:05:00+08:00">
                2016-11-19
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/git/" itemprop="url" rel="index">
                    <span itemprop="name">git</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/11/19/git-1git系列之从外部复制一个.git文件，如何使用/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/11/19/git-1git系列之从外部复制一个.git文件，如何使用/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>从外部复制一个.git文件，如何使用</p>
<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>有.git 文件　 ，直接使用，报错如下：</p>
<pre><code>fatal: &apos;/srv/OpenX.git&apos; does not appear to be a git repository
fatal: Could not read from remote repository.
</code></pre><p>现在有一个新来的.git文件, 如：OpenX.git</p>
<ol>
<li><p>放到本机的git仓库目录</p>
<pre><code>[tom@check repositories]$ sudo cp -a OpenX.git/ /srv/
</code></pre></li>
<li><p>建立新的下传使用目录</p>
<pre><code>[tom@check repositories]$ cd ../testgit/
[tom@check testgit]$ mkdir testgit2
[tom@check testgit]$ ls
OpenXtest  testgit2
[tom@check testgit]$ cd testgit2/
[tom@check testgit2]$ git init
Initialized empty Git repository in /home/tom/in/testgit/testgit2/.git/
</code></pre></li>
<li><p>下传pull</p>
<ol>
<li><p>remote报错啦</p>
<pre><code>[tom@check testgit2]$ git remote add checkgit git@192.168.31.181:/srv/OpenX.git
[tom@check testgit2]$ git pull checkgit master
git@192.168.31.181&apos;s password:
fatal: &apos;/srv/OpenX.git&apos; does not appear to be a git repository
fatal: Could not read from remote repository.

Please make sure you have the correct access rights
and the repository exists.
[tom@check testgit2]$
</code></pre></li>
<li><p>clone也是会报错哟</p>
<pre><code>[tom@check testgit2]$ git clone git@192.168.31.181:/srv/OpenX.git
Cloning into &apos;OpenX&apos;...
git@192.168.31.181&apos;s password:
fatal: &apos;/srv/OpenX.git&apos; does not appear to be a git repository
fatal: Could not read from remote repository.

Please make sure you have the correct access rights
and the repository exists.
[tom@check testgit2]$
</code></pre></li>
</ol>
</li>
</ol>
<h2 id="解决"><a href="#解决" class="headerlink" title="解决　"></a>解决　</h2><p>查看文件属性</p>
<pre><code>[tom@check testgit2]$ ll /srv/
total 0
drwxr-xr-x 7 git git 111 Jan 19 18:13 conan.git
drwxr-xr-x 7 git git 111 Jan 11 10:52 crawler.git
drwxr-xr-x 7 git git 111 Jan  8 16:19 eastmoney.git
drwx------ 7 tom tom 107 Feb 28 08:59 OpenX.git
drwxr-xr-x 7 git git 111 Jan 19 11:18 qlw.git
drwxr-xr-x 7 git git 111 Jan  6 15:03 sample.git
[tom@check testgit2]$
</code></pre><p>发现OpenX.git 属性不对.</p>
<p>检查是否安装git,并有git用户。如果没有，则建立git账户和密码<br>修改 OpenX.git 属性</p>
<pre><code>[tom@check testgit2]$ sudo chown -R git:git /srv/OpenX.git/
[tom@check testgit2]$ sudo chmod -R 755 /srv/OpenX.git/
[tom@check testgit2]$ ll /srv/
total 0
drwxr-xr-x 7 git git 111 Jan 19 18:13 conan.git
drwxr-xr-x 7 git git 111 Jan 11 10:52 crawler.git
drwxr-xr-x 7 git git 111 Jan  8 16:19 eastmoney.git
drwxr-xr-x 7 git git 107 Feb 28 08:59 OpenX.git
drwxr-xr-x 7 git git 111 Jan 19 11:18 qlw.git
drwxr-xr-x 7 git git 111 Jan  6 15:03 sample.git
[tom@check testgit2]$
</code></pre><p>验收</p>
<pre><code>[tom@check testgit2]$ git remote add checkgit git@192.168.31.181:/srv/OpenX.git
fatal: remote checkgit already exists.
[tom@check testgit2]$ git pull checkgit master
git@192.168.31.181&apos;s password:
remote: Counting objects: 1673, done.
remote: Compressing objects: 100% (1637/1637), done.
remote: Total 1673 (delta 928), reused 76 (delta 32)
Receiving objects: 100% (1673/1673), 6.90 MiB | 7.48 MiB/s, done.
Resolving deltas: 100% (928/928), done.
From 192.168.31.181:/srv/OpenX
 * branch            master     -&gt; FETCH_HEAD
[tom@check testgit2]$ ls
lib  OpenInfo  OpenQuote
[tom@check testgit2]$
</code></pre>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://tomtsang.github.io/2016/11/19/git/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Tom Tsang">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.png">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="tomtsang">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="tomtsang" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/11/19/git/" itemprop="url">
                  git系列之目录
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-11-19T18:04:56+08:00">
                2016-11-19
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/git/" itemprop="url" rel="index">
                    <span itemprop="name">git</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/11/19/git/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/11/19/git/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>git系列之目录</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://tomtsang.github.io/2016/11/19/hexo-1/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Tom Tsang">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.png">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="tomtsang">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="tomtsang" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/11/19/hexo-1/" itemprop="url">
                  hexo系列之使用1
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-11-19T17:39:24+08:00">
                2016-11-19
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/hexo/" itemprop="url" rel="index">
                    <span itemprop="name">hexo</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/11/19/hexo-1/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/11/19/hexo-1/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="hexo下新建页面下如何放多个文章？"><a href="#hexo下新建页面下如何放多个文章？" class="headerlink" title="hexo下新建页面下如何放多个文章？"></a>hexo下新建页面下如何放多个文章？</h2><p><a href="https://www.zhihu.com/question/33324071" target="_blank" rel="external">https://www.zhihu.com/question/33324071</a></p>
<h2 id="hexo分类与tags配置"><a href="#hexo分类与tags配置" class="headerlink" title="hexo分类与tags配置"></a>hexo分类与tags配置</h2><p>Hexo中如何给一篇文章加多个tags？<br>下面2种方式：</p>
<ul>
<li>tags: [a,b,c] # 冒号后有一个空格</li>
<li>tags:<br>  <code>- tag1</code><br>  <code>- tag2</code></li>
</ul>
<h2 id="可以做到自动增加哟。"><a href="#可以做到自动增加哟。" class="headerlink" title="可以做到自动增加哟。"></a>可以做到自动增加哟。</h2><pre><code>tom@adata:~/m6s/blogs/tomtsang$ hexo n &quot;mysql-21&quot;
INFO  Created: ~/m6s/blogs/tomtsang/source/_posts/mysql-21.md
tom@adata:~/m6s/blogs/tomtsang$ hexo n &quot;mysql&quot;
INFO  Created: ~/m6s/blogs/tomtsang/source/_posts/mysql-22.md
tom@adata:~/m6s/blogs/tomtsang$ hexo n &quot;mysql&quot;
INFO  Created: ~/m6s/blogs/tomtsang/source/_posts/mysql-23.md_
</code></pre><p>这样的话，方便形成系列的文章。每次就不用管是第几个mysql系列文章了。<br>不过系列文章，最好用的，还是 categories</p>
<h2 id="可以用自定义的post"><a href="#可以用自定义的post" class="headerlink" title="可以用自定义的post:"></a>可以用自定义的post:</h2><pre><code>tom@adata:~/m6s/blogs/tomtsang$ hexo n &quot;mysql&quot; [mysql]
INFO  Created: ~/m6s/blogs/tomtsang/source/_posts/mysql-4.md
tom@adata:~/m6s/blogs/tomtsang$ hexo n &quot;mysql&quot; [mysql]
INFO  Created: ~/m6s/blogs/tomtsang/source/_posts/mysql-5.md
tom@adata:~/m6s/blogs/tomtsang$ hexo n &quot;mysql&quot; [mysql]
INFO  Created: ~/m6s/blogs/tomtsang/source/_posts/mysql-1.md_
</code></pre><h2 id="end"><a href="#end" class="headerlink" title="end"></a>end</h2>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://tomtsang.github.io/2016/11/19/hexo/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Tom Tsang">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.png">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="tomtsang">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="tomtsang" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/11/19/hexo/" itemprop="url">
                  hexo系列之目录
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-11-19T15:44:56+08:00">
                2016-11-19
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/hexo/" itemprop="url" rel="index">
                    <span itemprop="name">hexo</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/11/19/hexo/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/11/19/hexo/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>hexo 系列之目录</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://tomtsang.github.io/2016/11/19/linux/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Tom Tsang">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.png">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="tomtsang">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="tomtsang" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/11/19/linux/" itemprop="url">
                  linux系列之目录
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-11-19T13:19:12+08:00">
                2016-11-19
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index">
                    <span itemprop="name">linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/11/19/linux/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/11/19/linux/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>linux系列之目录</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://tomtsang.github.io/2016/11/17/mysql-4mysql系列之集群 MariaDB Galera Cluster 部署/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Tom Tsang">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.png">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="tomtsang">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="tomtsang" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/11/17/mysql-4mysql系列之集群 MariaDB Galera Cluster 部署/" itemprop="url">
                  mysql系列之集群 MariaDB Galera Cluster 部署
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-11-17T18:29:59+08:00">
                2016-11-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/mysql/" itemprop="url" rel="index">
                    <span itemprop="name">mysql</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/11/17/mysql-4mysql系列之集群 MariaDB Galera Cluster 部署/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/11/17/mysql-4mysql系列之集群 MariaDB Galera Cluster 部署/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="http://www.unixmen.com/setup-mariadb-galera-cluster-10-0-centos/" target="_blank" rel="external">How To Setup MariaDB Galera Cluster 10.0 On CentOS</a><br><a href="http://www.unixmen.com/setup-mariadb-galera-cluster-10-0-centos/" target="_blank" rel="external">http://www.unixmen.com/setup-mariadb-galera-cluster-10-0-centos/</a></p>
<h2 id="安装-过程"><a href="#安装-过程" class="headerlink" title="安装 过程"></a>安装 过程</h2><p><em>MariaDB</em> is a relational database management system (RDBMS) and  <a href="https://mariadb.com/kb/en/mariadb/what-is-mariadb-galera-cluster/" target="_blank" rel="external">MariaDB Galera Cluster</a> is a synchronous multi-master cluster for MariaDB. It is available on Linux only, and only supports the <em>XtraDB/InnoDB</em> storage engines. This article explains how to setup MariaDB Galera Cluster 10.0 with 3 nodes running on CentOS 6.5(tom注：在CentOS 7.0上也成功) x86_64 resulting in a HA (high-availability) database cluster.</p>
<h4 id="CLUSTER-DETAILS"><a href="#CLUSTER-DETAILS" class="headerlink" title="CLUSTER DETAILS"></a>CLUSTER DETAILS</h4><p>We using 3 freshly deployed VMs running a minimal install of CentOS 6.5 x86_64.</p>
<pre><code>Cluster node 1 has hostname db1 and IP address 1.1.1.1
Cluster node 2 has hostname db2 and IP address 1.1.1.2
Cluster node 3 has hostname db3 and IP address 1.1.1.3
</code></pre><h2 id="Step-1-Add-MariaDB-Repositories"><a href="#Step-1-Add-MariaDB-Repositories" class="headerlink" title="Step 1: Add MariaDB Repositories"></a>Step 1: Add MariaDB Repositories</h2><p>Create a mariadb repository <code>/etc/yum.repos.d/mariadb.repo</code> using following content in your system.</p>
<p>For CentOS 7 – 64bit:</p>
<pre><code>[mariadb]
name = MariaDB
baseurl = http://yum.mariadb.org/10.0/centos7-amd64
gpgkey=https://yum.mariadb.org/RPM-GPG-KEY-MariaDB
gpgcheck=1
</code></pre><p>For CentOS 7 – 32bit:</p>
<pre><code>[mariadb]
name = MariaDB
baseurl = http://yum.mariadb.org/10.0/centos7-x86
gpgkey=https://yum.mariadb.org/RPM-GPG-KEY-MariaDB
gpgcheck=1
</code></pre><h2 id="Step-2-–-Set-SELinux-in-permissive-mode"><a href="#Step-2-–-Set-SELinux-in-permissive-mode" class="headerlink" title="Step 2 – Set SELinux in permissive mode"></a>Step 2 – Set SELinux in permissive mode</h2><p>Before starting the setup put SELinux into permissive mode on all nodes:</p>
<pre><code>sudo setenforce 0
</code></pre><h2 id="Step-3-–-Install-MariaDB-Galera-Cluster-10-0-software"><a href="#Step-3-–-Install-MariaDB-Galera-Cluster-10-0-software" class="headerlink" title="Step 3 – Install MariaDB Galera Cluster 10.0 software"></a>Step 3 – Install MariaDB Galera Cluster 10.0 software</h2><p>If you did a CentOS 6 minimal installation then make sure you install the socat package from the EPEL repository before proceeding with installing the MariaDB Galera Cluster 10.0 software.</p>
<p>You can install socat package directly from EPEL with the following command (for x86_64):</p>
<pre><code>sudo yum install http://dl.fedoraproject.org/pub/epel/6/x86_64/socat-1.7.2.3-1.el6.x86_64.rpm
</code></pre><p>On CentOS 7 you can install socat package with following command.</p>
<pre><code>sudo yum install socat -y
</code></pre><p>Install the MariaDB Galera Cluster 10.0 software by executing the following command on all nodes:</p>
<pre><code>sudo yum install MariaDB-Galera-server MariaDB-client rsync galera -y
</code></pre><p>如果说，这一步没有安装成功，请参考之前的那一篇<a href="tomtsang.github.io/2016/11/15/mysql-1/">mysql系列之集群 MariaDB-Galera-server 安装</a></p>
<h2 id="Step-4-Setup-MariaDB-security"><a href="#Step-4-Setup-MariaDB-security" class="headerlink" title="Step 4:  Setup MariaDB security"></a>Step 4:  Setup MariaDB security</h2><p>Start the mysql ( init script in MariaDB 10.0 is still called mysql)</p>
<pre><code>sudo service mysql start
</code></pre><p>Run the <code>mysql_secure_installation</code> script so we can improve the security. Run the following command on all nodes:</p>
<pre><code>sudo /usr/bin/mysql_secure_installation
</code></pre><p>I choose password as ‘<code>dbpass</code>’ and accepted all defaults (so answered <code>yes</code> to all questions).</p>
<h2 id="Step-5-–-Create-MariaDB-Galera-Cluster-users"><a href="#Step-5-–-Create-MariaDB-Galera-Cluster-users" class="headerlink" title="Step 5 – Create MariaDB Galera Cluster users"></a>Step 5 – Create MariaDB Galera Cluster users</h2><p>Now, we have to create some users that must be able to access the database. The ‘sst_user’ is the user which a database node will use for authenticating to another database node in the State Transfer Snapshot (SST) phase. Run the following command on all nodes:</p>
<pre><code>mysql -u root -p
mysql&gt; DELETE FROM mysql.user WHERE user=&apos;&apos;;
mysql&gt; GRANT ALL ON *.* TO &apos;root&apos;@&apos;%&apos; IDENTIFIED BY &apos;dbpass&apos;;
mysql&gt; GRANT USAGE ON *.* to sst_user@&apos;%&apos; IDENTIFIED BY &apos;dbpass&apos;;
mysql&gt; GRANT ALL PRIVILEGES on *.* to sst_user@&apos;%&apos;;
mysql&gt; FLUSH PRIVILEGES;
mysql&gt; quit
</code></pre><p>You are suggested to change ‘<code>%</code>’ to hostname(s) or IP addresses from which those users can access the database. Because ‘<code>%</code>’ means that the <code>root</code> or <code>sst_user</code> is allowed to access the database from any host, So less security.</p>
<h2 id="Step-6-–-Create-the-MariaDB-Galera-Cluster-config"><a href="#Step-6-–-Create-the-MariaDB-Galera-Cluster-config" class="headerlink" title="Step 6 – Create the MariaDB Galera Cluster config"></a>Step 6 – Create the MariaDB Galera Cluster config</h2><p>First stop the mysql services on all nodes:</p>
<pre><code>sudo service mysql stop
</code></pre><p>Next, We are going to create the MariaDB Galera Cluster configuration by the following command on all nodes (go through the IMPORTANT NOTE after the config and make required changes for db2, and db3):</p>
<pre><code>sudo cat &gt;&gt; /etc/my.cnf.d/server.cnf &lt;&lt; EOF

[mariadb-10.0]
binlog_format=ROW
default-storage-engine=innodb
innodb_autoinc_lock_mode=2
innodb_locks_unsafe_for_binlog=1
query_cache_size=0
query_cache_type=0
bind-address=0.0.0.0
datadir=/var/lib/mysql
innodb_log_file_size=100M
innodb_file_per_table
innodb_flush_log_at_trx_commit=2
wsrep_provider=/usr/lib64/galera/libgalera_smm.so
wsrep_cluster_address=&quot;gcomm://1.1.1.1,1.1.1.2,1.1.1.3&quot;
wsrep_cluster_name=&apos;galera_cluster&apos;
wsrep_node_address=&apos;1.1.1.1&apos;
wsrep_node_name=&apos;db1&apos;
wsrep_sst_method=rsync
wsrep_sst_auth=sst_user:dbpass
EOF
</code></pre><p><em>IMPORTANT NOTE</em>: when executing this command on db2 and db3 do not forget to adjust the <code>wsrep_node_address</code> and <code>wsrep_node_name</code> variables.</p>
<p>On db2 :</p>
<pre><code>wsrep_node_address=1.1.1.2
wsrep_node_name=&apos;db2&apos;
</code></pre><p>On db3 :</p>
<pre><code>wsrep_node_address=&apos;1.1.1.3&apos;
wsrep_node_name=&apos;db3&apos;
</code></pre><h2 id="Step-7–-Initialize-the-first-cluster-node"><a href="#Step-7–-Initialize-the-first-cluster-node" class="headerlink" title="Step 7– Initialize the first cluster node"></a>Step 7– Initialize the first cluster node</h2><p>Start MariaDB with the special ‘<code>‐‐wsrep-new-cluster</code>’ option , Do it on node <code>db1</code> only so the primary node of the cluster is initialized:</p>
<pre><code>sudo /etc/init.d/mysql start --wsrep-new-cluster
</code></pre><p>Check status by run the following command on node db1 only:</p>
<pre><code>mysql -u root -p -e &quot;show status like &apos;wsrep%&apos;;&quot;
</code></pre><p>Some important information in the output are the following lines:</p>
<pre><code>wsrep_local_state_comment | Synced &lt;-- cluster is synced
wsrep_incoming_addresses  | 1.1.1.1:3306 &lt;-- node db1 is a provider
wsrep_cluster_size        | 1 &lt;-- cluster consists of 1 node
wsrep_ready               | ON &lt;-- good :)
</code></pre><p>如果说这里报错了，请参考<a href="tomtsang.github.io/">mysql系列之集群 MariaDB-Galera-cluster 报错</a></p>
<h2 id="Step-8–-Add-the-other-cluster-nodes"><a href="#Step-8–-Add-the-other-cluster-nodes" class="headerlink" title="Step 8– Add the other cluster nodes"></a>Step 8– Add the other cluster nodes</h2><p>Check and confirm nodes db2 and db3 have the correct configuration in <code>/etc/my.cnf.d/server.cnf</code> under the [<code>mariadb-10.0</code>] as described in step 6.</p>
<p>With the correct configuration in place, all that is required to make db2 and db3 a member of the cluster is to start them like you would start any regular service. On db2 issue the following command:</p>
<pre><code>sudo service mysql start
</code></pre><p>Check what has changed in the cluster status by executing the following command on db1 or db2:</p>
<pre><code>mysql -u root -p -e &quot;show status like &apos;wsrep%&apos;;&quot;
</code></pre><p>And you will see that node db2 is now known as the cluster size is ‘2’ and the IP address of node db2 is listed:</p>
<pre><code>| wsrep_local_state_comment | Synced                    |
| wsrep_incoming_addre sses | 1.1.1.1:3306,1.1.1.2:3306 |
| wsrep_cluster_size        | 2                         |
| wsrep_connected           | ON                        |
| wsrep_ready               | ON                        |
</code></pre><p>Repeat the same step for node db3. On node db3 only execute the following command</p>
<pre><code>sudo service mysql start
</code></pre><p>Check what has changed in the cluster status by executing the following command on for example db1:</p>
<pre><code>mysql -u root -p -e &quot;show status like &apos;wsrep%&apos;;&quot;
</code></pre><p>And you should see that node db3 is now known as the cluster size is ‘3’ and the IP address of node db3 is listed:</p>
<pre><code>| wsrep_local_state_comment | Synced                                 |
| wsrep_incoming_addresses  | 1.1.1.3:3306,1.1.1.1:3306,1.1.1.2:3306 |
| wsrep_cluster_size        | 3                                      |
| wsrep_connected           | ON                                     |
| wsrep_ready               | ON                                     |
</code></pre><h2 id="Step-9-–-Verify-replication"><a href="#Step-9-–-Verify-replication" class="headerlink" title="Step 9 – Verify replication"></a>Step 9 – Verify replication</h2><p>Now the cluster is running. Let’s test whether it is working. On db1 create a database ‘clustertest’ by run the following command:</p>
<pre><code>mysql -u root -p -e &apos;CREATE DATABASE clustertest;&apos;

mysql -u root -p -e &apos;CREATE TABLE clustertest.mycluster ( id INT NOT NULL AUTO_INCREMENT, name VARCHAR(50), ipaddress VARCHAR(20), PRIMARY KEY(id));&apos;

mysql -u root -p -e &apos;INSERT INTO clustertest.mycluster (name, ipaddress) VALUES (&quot;db1&quot;, &quot;1.1.1.1&quot;);&apos;
</code></pre><p>Check if the database, table and data exists:</p>
<pre><code>mysql -u root -p -e &apos;SELECT * FROM clustertest.mycluster;&apos;
Enter password:
+----+------+-----------+
| id | name | ipaddress |
+----+------+-----------+
| 2  | db1  | 1.1.1.1   |
+----+------+-----------+
</code></pre><p>Now do the check on node db2:</p>
<pre><code>mysql -u root -p -e &apos;SELECT * FROM clustertest.mycluster;&apos;
Enter password:
+----+------+-----------+
| id | name | ipaddress |
+----+------+-----------+
| 2  | db1  | 1.1.1.1   |
+----+------+-----------+
</code></pre><p>Now do the same check on node db3:</p>
<pre><code>mysql -u root -p -e &apos;SELECT * FROM clustertest.mycluster;&apos;
Enter password:
+----+------+-----------+
| id | name | ipaddress |
+----+------+-----------+
| 2  | db1  | 1.1.1.1   |
+----+------+-----------+
</code></pre><p>From these outputs we can confirm that everything was successfully replicated by node db1 across all other nodes.</p>
<p>That’s it.</p>
<p>Cheers!</p>
<h2 id="ctrl-v-吧"><a href="#ctrl-v-吧" class="headerlink" title="ctrl + v 吧"></a>ctrl + v 吧</h2><pre><code>sudo vi /etc/hosts
    10.10.162.11    db1
    10.10.162.12    db2
    10.10.162.13    db3
sudo vi /etc/yum.repos.d/mariadb.repo
    # MariaDB 10.1 CentOS repository list - created 2016-11-15 02:38 UTC
    # http://downloads.mariadb.org/mariadb/repositories/
    [mariadb]
    name = MariaDB
    baseurl = http://yum.mariadb.org/10.0/centos7-amd64
    gpgkey=https://yum.mariadb.org/RPM-GPG-KEY-MariaDB
    gpgcheck=1
sudo setenforce 0
sudo yum install socat -y
sudo yum install socat MariaDB-Galera-server MariaDB-client rsync galera -y
sudo service mysql start
sudo /usr/bin/mysql_secure_installation
mysql -u root -p
sudo service mysql stop
sudo cat &gt;&gt; /etc/my.cnf.d/server.cnf &lt;&lt; EOF
    binlog_format=ROW
    default-storage-engine=innodb
    innodb_autoinc_lock_mode=2
    innodb_locks_unsafe_for_binlog=1
    query_cache_size=0
    query_cache_type=0
    bind-address=0.0.0.0
    datadir=/var/lib/mysql
    innodb_log_file_size=100M
    innodb_file_per_table
    innodb_flush_log_at_trx_commit=2
    wsrep_provider=/usr/lib64/galera/libgalera_smm.so
    wsrep_cluster_address=&quot;gcomm://1.1.1.1,1.1.1.2,1.1.1.3&quot;
    wsrep_cluster_name=&apos;galera_cluster&apos;
    wsrep_node_address=&apos;1.1.1.1&apos;
    wsrep_node_name=&apos;db1&apos;
    wsrep_sst_method=rsync
    wsrep_sst_auth=sst_user:dbpass
    EOF
# 上面这个好像会出错，算了，我们 sudo vi 吧
sudo vi /etc/my.cnf.d/server.cnf
sudo cp -a /etc/my.cnf.d/server.cnf .
ls
sudo cp -a server.cnf server.cnf.12
sudo cp -a server.cnf server.cnf.13
sudo vi server.cnf.12
sudo vi server.cnf.13
scp server.cnf.12 spa@s12:/home/spa/  # 之后在spa@s12中改一改吧。
scp server.cnf.13 spa@s13:/home/spa/
# 好了，现在三台机器的配置都完成啦！
sudo /etc/init.d/mysql start --wsrep-new-cluster
mysql -u root -p -e &quot;show status like &apos;wsrep%&apos;;&quot;
# 好了，如果没有问题，我们把其它2台机器也启动下。 sudo service mysql start; sudo service mysql status;
mysql -u root -p -e &apos;CREATE DATABASE clustertest;&apos;
mysql -u root -p -e &apos;CREATE TABLE clustertest.mycluster ( id INT NOT NULL AUTO_INCREMENT, name VARCHAR(50), ipaddress VARCHAR(20), PRIMARY KEY(id));&apos;
mysql -u root -p -e &apos;INSERT INTO clustertest.mycluster (name, ipaddress) VALUES (&quot;db1&quot;, &quot;1.1.1.1&quot;);&apos;
mysql -u root -p -e &apos;SELECT * FROM clustertest.mycluster;&apos;
# 到其它2台机器上也查一下吧。 mysql -u root -p -e &apos;SELECT * FROM clustertest.mycluster;&apos;
# 如果其它机器也显示出来了，那就Cheers!
</code></pre>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://tomtsang.github.io/2016/11/17/mysql-5mysql系列之集群 MariaDB-Galera-cluster 报错/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Tom Tsang">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.png">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="tomtsang">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="tomtsang" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/11/17/mysql-5mysql系列之集群 MariaDB-Galera-cluster 报错/" itemprop="url">
                  mysql系列之集群 MariaDB-Galera-cluster 报错
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-11-17T16:45:39+08:00">
                2016-11-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/mysql/" itemprop="url" rel="index">
                    <span itemprop="name">mysql</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/11/17/mysql-5mysql系列之集群 MariaDB-Galera-cluster 报错/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/11/17/mysql-5mysql系列之集群 MariaDB-Galera-cluster 报错/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="报错1-etc-my-cnf-d-下-有一个-不应该存在的-cnf"><a href="#报错1-etc-my-cnf-d-下-有一个-不应该存在的-cnf" class="headerlink" title="报错1, /etc/my.cnf.d/下 有一个 不应该存在的 .cnf"></a>报错1, /etc/my.cnf.d/下 有一个 不应该存在的 .cnf</h2><p>错误原因：</p>
<p>mysql 加载了 /etc/my.cnf.d/下的所有 <code>*.cnf</code> 文件，其中又有一个之前的不应该存在的 <code>*.cnf</code>。</p>
<p>正确情况下，应该只有4个<code>.cnf</code>文件。<br>    [spa@s11 ~]$ ls /etc/my.cnf.d/<br>    client.cnf  mysql-clients.cnf  server.cnf  tokudb.cnf<br>    [spa@s11 ~]$</p>
<p>错误情况：</p>
<pre><code>[tom@kube-node-13 ~]$ sudo /etc/init.d/mysql start --wsrep-new-cluster
Starting MySQL.161116 17:44:54 mysqld_safe Logging to &apos;/data/mariadb/mysql/kube-node-13.err&apos;.
. SUCCESS!
[tom@kube-node-13 ~]$ mysql -u root -p -e &quot;show status like &apos;wsrep%&apos;&quot;
Enter password:
+--------------------------+----------------------+
| Variable_name            | Value                |
+--------------------------+----------------------+
| wsrep_cluster_conf_id    | 18446744073709551615 |
| wsrep_cluster_size       | 0                    |
| wsrep_cluster_state_uuid |                      |
| wsrep_cluster_status     | Disconnected         |
| wsrep_connected          | OFF                  |
| wsrep_local_bf_aborts    | 0                    |
| wsrep_local_index        | 18446744073709551615 |
| wsrep_provider_name      |                      |
| wsrep_provider_vendor    |                      |
| wsrep_provider_version   |                      |
| wsrep_ready              | ON                   |
| wsrep_thread_count       | 0                    |
+--------------------------+----------------------+
[tom@kube-node-13 ~]$
</code></pre><p>解决过程：</p>
<p>怎么办呢？</p>
<p>先看状态</p>
<pre><code>[tom@kube-node-13 ~]$ sudo service mysql status -l
 SUCCESS! MySQL running (11946)
</code></pre><p>关闭掉，我们来手动启动查原因。</p>
<pre><code>[tom@kube-node-13 ~]$ sudo service mysql stop
Shutting down MySQL... SUCCESS!
[tom@kube-node-13 ~]$
</code></pre><p>查一下，如何手动启动</p>
<pre><code>[spa@s11 ~]$ which mysqld
/usr/sbin/mysqld
[cdn@test_240 OpenPicker]$ mysqld --help
mysqld  Ver 10.0.28-MariaDB-wsrep for Linux on x86_64 (MariaDB Server, wsrep_25.16.rc3fc46e)
Copyright (c) 2000, 2016, Oracle, MariaDB Corporation Ab and others.

Starts the MariaDB database server.

Usage: mysqld [OPTIONS]

For more help options (several pages), use mysqld --verbose --help.
[cdn@test_240 OpenPicker]$ use mysqld --verbose --help
...
一大串
...
</code></pre><p>手动启动</p>
<pre><code>[tom@kube-node-13 ~]$ mysqld --verbose
161116 18:30:01 [Note] mysqld (mysqld 10.0.28-MariaDB-wsrep) starting as process 12713 ...
161116 18:30:01 [Warning] Can&apos;t create test file /data/mariadb/mysql/kube-node-13.lower-test
161116 18:30:01 [Note] WSREP: Read nil XID from storage engines, skipping position init
161116 18:30:01 [Note] WSREP: wsrep_load(): loading provider library &apos;/usr/lib/galera/libgalera_smm.so&apos;
161116 18:30:01 [ERROR] WSREP: wsrep_load(): dlopen(): /usr/lib/galera/libgalera_smm.so: cannot open shared object file: No such file or directory
161116 18:30:01 [ERROR] WSREP: wsrep_load(/usr/lib/galera/libgalera_smm.so) failed: Invalid argument (22). Reverting to no provider.
161116 18:30:01 [Note] WSREP: Read nil XID from storage engines, skipping position init
161116 18:30:01 [Note] WSREP: wsrep_load(): loading provider library &apos;none&apos;
2016-11-16 18:30:01 7f1069f42880 InnoDB: Warning: Using innodb_locks_unsafe_for_binlog is DEPRECATED. This option may be removed in future releases. Please use READ COMMITTED transaction isolation level instead, see http://dev.mysql.com/doc/refman/5.6/en/set-transaction.html.
161116 18:30:01 [Note] InnoDB: Using mutexes to ref count buffer pool pages
161116 18:30:01 [Note] InnoDB: The InnoDB memory heap is disabled
161116 18:30:01 [Note] InnoDB: Mutexes and rw_locks use GCC atomic builtins
161116 18:30:01 [Note] InnoDB: GCC builtin __atomic_thread_fence() is used for memory barrier
161116 18:30:01 [Note] InnoDB: Compressed tables use zlib 1.2.7
161116 18:30:01 [Note] InnoDB: Using Linux native AIO
161116 18:30:01 [Note] InnoDB: Using CPU crc32 instructions
161116 18:30:01 [Note] InnoDB: Initializing buffer pool, size = 128.0M
161116 18:30:01 [Note] InnoDB: Completed initialization of buffer pool
161116 18:30:01 [ERROR] InnoDB: ./ibdata1 can&apos;t be opened in read-write mode
161116 18:30:01 [ERROR] InnoDB: The system tablespace must be writable!
161116 18:30:01 [ERROR] Plugin &apos;InnoDB&apos; init function returned error.
161116 18:30:01 [ERROR] Plugin &apos;InnoDB&apos; registration as a STORAGE ENGINE failed.
161116 18:30:01 [ERROR] mysqld: File &apos;/data/mariadb/mysql/aria_log_control&apos; not found (Errcode: 13 &quot;Permission denied&quot;)
161116 18:30:01 [ERROR] mysqld: Got error &apos;Can&apos;t open file&apos; when trying to use aria control file &apos;/data/mariadb/mysql/aria_log_control&apos;
161116 18:30:01 [ERROR] Plugin &apos;Aria&apos; init function returned error.
161116 18:30:01 [ERROR] Plugin &apos;Aria&apos; registration as a STORAGE ENGINE failed.
161116 18:30:01 [Note] Plugin &apos;FEEDBACK&apos; is disabled.
161116 18:30:01 [ERROR] Can&apos;t open the mysql.plugin table. Please run mysql_upgrade to create it.
161116 18:30:01 [ERROR] Unknown/unsupported storage engine: innodb
161116 18:30:01 [ERROR] Aborting

161116 18:30:01 [Note] WSREP: Service disconnected.
161116 18:30:02 [Note] WSREP: Some threads may fail to exit.
161116 18:30:02 [Note] mysqld: Shutdown complete
</code></pre><p>看到了吧，上面有一行</p>
<p><code>161116 18:30:01 [ERROR] WSREP: wsrep_load(): dlopen(): /usr/lib/galera/libgalera_smm.so: cannot open shared object file: No such file or directory</code></p>
<p>说明有问题了吧。<br>先这样，我们确保一下，启动程序的用户是mysql,来吧。</p>
<pre><code>[tom@kube-node-13 ~]$ sudo --help
sudo: invalid option -- &apos;-&apos;
usage: sudo [-D level] -h | -K | -k | -V
usage: sudo -v [-AknS] [-D level] [-g groupname|#gid] [-p prompt] [-u user name|#uid]
usage: sudo -l[l] [-AknS] [-D level] [-g groupname|#gid] [-p prompt] [-U user name] [-u user name|#uid] [-g groupname|#gid] [command]
usage: sudo [-AbEHknPS] [-r role] [-t type] [-C fd] [-D level] [-g groupname|#gid] [-p prompt] [-u user name|#uid] [-g groupname|#gid] [VAR=value] [-i|-s] [&lt;command&gt;]
usage: sudo -e [-AknS] [-r role] [-t type] [-C fd] [-D level] [-g groupname|#gid] [-p prompt] [-u user name|#uid] file ...
[tom@kube-node-13 ~]$
</code></pre><p>好了，知道了，用sudo -u ,那这个 -u 后面接什么用户呢？mysql ,还是 mysqld？</p>
<pre><code>[tom@kube-node-13 ~]$ ll /var/lib/mysql/
total 217128
-rw-rw----. 1 mysql mysql     16384 11月 16 18:18 aria_log.00000001
-rw-rw----. 1 mysql mysql        52 11月 16 18:18 aria_log_control
-rw-rw----. 1 mysql mysql  12582912 11月 16 18:18 ibdata1
-rw-rw----. 1 mysql mysql 104857600 11月 16 18:18 ib_logfile0
-rw-rw----. 1 mysql mysql 104857600 11月 16 18:18 ib_logfile1
-rw-r-----. 1 mysql root       5489 11月 16 18:18 kube-node-13.err
-rw-rw----. 1 mysql mysql         0 11月 16 13:34 multi-master.info
drwx--x--x. 2 mysql mysql      4096 11月 16 12:51 mysql
srwxrwxrwx. 1 mysql mysql         0 11月 17 10:28 mysql.sock
drwx------. 2 mysql mysql      4096 11月 16 12:51 performance_schema
-rw-------. 1 mysql root       2538 11月 16 18:18 wsrep_recovery.N15shv
[tom@kube-node-13 ~]$
</code></pre><p>好了，现在知道了，这些文件都是 <code>mysql</code>用户的，那自然，我们应该是 <code>sudo -u mysql</code> .<br>来吧。</p>
<pre><code>[tom@kube-node-13 ~]$ sudo -u mysql mysqld --verbose
161116 18:32:38 [Note] mysqld (mysqld 10.0.28-MariaDB-wsrep) starting as process 12963 ...
161116 18:32:38 [Note] WSREP: Read nil XID from storage engines, skipping position init
161116 18:32:38 [Note] WSREP: wsrep_load(): loading provider library &apos;/usr/lib/galera/libgalera_smm.so&apos;
161116 18:32:38 [ERROR] WSREP: wsrep_load(): dlopen(): /usr/lib/galera/libgalera_smm.so: cannot open shared object file: No such file or directory
161116 18:32:38 [ERROR] WSREP: wsrep_load(/usr/lib/galera/libgalera_smm.so) failed: Invalid argument (22). Reverting to no provider.
161116 18:32:38 [Note] WSREP: Read nil XID from storage engines, skipping position init
161116 18:32:38 [Note] WSREP: wsrep_load(): loading provider library &apos;none&apos;
2016-11-16 18:32:38 7f71c04dd880 InnoDB: Warning: Using innodb_locks_unsafe_for_binlog is DEPRECATED. This option may be removed in future releases. Please use READ COMMITTED transaction isolation level instead, see http://dev.mysql.com/doc/refman/5.6/en/set-transaction.html.
161116 18:32:38 [Note] InnoDB: Using mutexes to ref count buffer pool pages
161116 18:32:38 [Note] InnoDB: The InnoDB memory heap is disabled
161116 18:32:38 [Note] InnoDB: Mutexes and rw_locks use GCC atomic builtins
161116 18:32:38 [Note] InnoDB: GCC builtin __atomic_thread_fence() is used for memory barrier
161116 18:32:38 [Note] InnoDB: Compressed tables use zlib 1.2.7
161116 18:32:38 [Note] InnoDB: Using Linux native AIO
161116 18:32:38 [Note] InnoDB: Using CPU crc32 instructions
161116 18:32:38 [Note] InnoDB: Initializing buffer pool, size = 128.0M
161116 18:32:38 [Note] InnoDB: Completed initialization of buffer pool
161116 18:32:38 [Note] InnoDB: Highest supported file format is Barracuda.
161116 18:32:38 [Note] InnoDB: 128 rollback segment(s) are active.
161116 18:32:38 [Note] InnoDB: Waiting for purge to start
161116 18:32:38 [Note] InnoDB:  Percona XtraDB (http://www.percona.com) 5.6.32-79.0 started; log sequence number 1624176
161116 18:32:38 [Note] Plugin &apos;FEEDBACK&apos; is disabled.
161116 18:32:38 [Note] Server socket created on IP: &apos;0.0.0.0&apos;.
161116 18:32:38 [Note] WSREP: Read nil XID from storage engines, skipping position init
161116 18:32:38 [Note] WSREP: wsrep_load(): loading provider library &apos;none&apos;
161116 18:32:38 [Note] mysqld: ready for connections.
Version: &apos;10.0.28-MariaDB-wsrep&apos;  socket: &apos;/var/lib/mysql/mysql.sock&apos;  port: 3306  MariaDB Server, wsrep_25.16.rc3fc46e
^C^C^C^C^C^CKilled
[tom@kube-node-13 ~]$
</code></pre><p>看到了。错误</p>
<p><code>161116 18:32:38 [ERROR] WSREP: wsrep_load(): dlopen(): /usr/lib/galera/libgalera_smm.so: cannot open shared object file: No such file or directory</code></p>
<p>还在。</p>
<p>找一下，看这个文件在不在了？</p>
<pre><code>[tom@kube-node-13 ~]$ sudo ls -l /usr/lib/galera/libgalera_smm.so
ls: cannot access /usr/lib/galera/libgalera_smm.so: No such file or directory
</code></pre><p>好了，这个文件真的不存在。<br>那试一下 /usr/lib64/ 下有没有这个文件呢？</p>
<pre><code>[tom@kube-node-13 ~]$ sudo ls  /usr/lib64/galera/libgalera_smm.so
/usr/lib64/galera/libgalera_smm.so
</code></pre><p>哈哈。有呀。<br>那看一下，我们配置里面的是哪个？</p>
<pre><code>[tom@kube-node-13 ~]$ sudo cat /etc/my.cnf.d/server.cnf
...
binlog_format=ROW
default-storage-engine=innodb
innodb_autoinc_lock_mode=2
innodb_locks_unsafe_for_binlog=1
query_cache_size=0
query_cache_type=0
bind-address=0.0.0.0
datadir=/data/mariadb/mysql
#datadir=/var/lib/mysql
innodb_log_file_size=100M
innodb_file_per_table
innodb_flush_log_at_trx_commit=2
wsrep_provider=/usr/lib64/galera/libgalera_smm.so
wsrep_cluster_address=&quot;gcomm://10.10.13.110,192.168.31.240,10.10.12.13&quot;
wsrep_cluster_name=&apos;galera_cluster&apos;
wsrep_node_address=&apos;10.10.12.13&apos;
wsrep_node_name=&apos;db3&apos;
wsrep_sst_method=rsync
wsrep_sst_auth=sst_user:dbpass
</code></pre><p>看到了吧，是<code>wsrep_provider=/usr/lib64/galera/libgalera_smm.so</code>。是<code>/usr/lib64/</code>。那说明了，程序没有成功加载我们的配置文件呀。</p>
<p>无论怎样，我们先做一个软链接，看下，能不能成功。</p>
<p>注意哈，这里是直接把整个文件夹做成软链接，不要写错了。不是<code>sudo ln -s /usr/lib64/galera/ /usr/lib/galera/</code>， 更不是<code>sudo ln -s /usr/lib64/galera/ /usr/lib/galera/</code>。</p>
<pre><code>[tom@kube-node-13 galera]$ sudo ln -s /usr/lib64/galera /usr/lib/galera
[tom@kube-node-13 galera]$ cd /usr/lib/galera/
[tom@kube-node-13 galera]$ ls
libgalera_smm.so
[tom@kube-node-13 galera]$
</code></pre><p>做好了。再来一次。</p>
<pre><code>[tom@kube-node-13 galera]$ sudo -u mysql mysqld --verbose
161116 18:46:07 [Note] mysqld (mysqld 10.0.28-MariaDB-wsrep) starting as process 14216 ...
161116 18:46:07 [Note] WSREP: Read nil XID from storage engines, skipping position init
161116 18:46:07 [Note] WSREP: wsrep_load(): loading provider library &apos;/usr/lib/galera/libgalera_smm.so&apos;
161116 18:46:07 [Note] WSREP: wsrep_load(): Galera 25.3.18(r3632) by Codership Oy &lt;info@codership.com&gt; loaded successfully.
161116 18:46:07 [Note] WSREP: CRC-32C: using hardware acceleration.
161116 18:46:07 [Warning] WSREP: Could not open state file for reading: &apos;/data/mariadb/mysql//grastate.dat&apos;
161116 18:46:07 [Note] WSREP: Found saved state: 00000000-0000-0000-0000-000000000000:-1
161116 18:46:07 [Note] WSREP: Passing config to GCS: base_dir = /data/mariadb/mysql/; base_host = 10.10.12.13; base_port = 4567; cert.log_conflicts = no; debug = no; evs.auto_evict = 0; evs.delay_margin = PT1S; evs.delayed_keep_period = PT30S; evs.inactive_check_period = PT0.5S; evs.inactive_timeout = PT15S; evs.join_retrans_period = PT1S; evs.max_install_timeouts = 3; evs.send_window = 4; evs.stats_report_period = PT1M; evs.suspect_timeout = PT5S; evs.user_send_window = 2; evs.view_forget_timeout = PT24H; gcache.dir = /data/mariadb/mysql/; gcache.keep_pages_size = 0; gcache.mem_size = 0; gcache.name = /data/mariadb/mysql//galera.cache; gcache.page_size = 128M; gcache.size = 128M; gcomm.thread_prio = ; gcs.fc_debug = 0; gcs.fc_factor = 1.0; gcs.fc_limit = 16; gcs.fc_master_slave = no; gcs.max_packet_size = 64500; gcs.max_throttle = 0.25; gcs.recv_q_hard_limit = 9223372036854775807; gcs.recv_q_soft_limit = 0.25; gcs.sync_donor = no; gmcast.segment = 0; gmcast.version = 0; pc.announce_timeout = PT3S; pc.checksum = false; pc.ignore_q
161116 18:46:07 [Note] WSREP: Service thread queue flushed.
161116 18:46:07 [Note] WSREP: Assign initial position for certification: -1, protocol version: -1
161116 18:46:07 [Note] WSREP: wsrep_sst_grab()
161116 18:46:07 [Note] WSREP: Start replication
161116 18:46:07 [Note] WSREP: Setting initial position to 00000000-0000-0000-0000-000000000000:-1
161116 18:46:07 [Note] WSREP: protonet asio version 0
161116 18:46:07 [Note] WSREP: Using CRC-32C for message checksums.
161116 18:46:07 [Note] WSREP: backend: asio
161116 18:46:07 [Note] WSREP: gcomm thread scheduling priority set to other:0
161116 18:46:07 [Warning] WSREP: access file(/data/mariadb/mysql//gvwstate.dat) failed(No such file or directory)
161116 18:46:07 [Note] WSREP: restore pc from disk failed
161116 18:46:07 [Note] WSREP: GMCast version 0
161116 18:46:07 [Note] WSREP: (e0f5cb2a, &apos;tcp://0.0.0.0:4567&apos;) listening at tcp://0.0.0.0:4567
161116 18:46:07 [Note] WSREP: (e0f5cb2a, &apos;tcp://0.0.0.0:4567&apos;) multicast: , ttl: 1
161116 18:46:07 [Note] WSREP: EVS version 0
161116 18:46:07 [Note] WSREP: gcomm: connecting to group &apos;my_wsrep_cluster&apos;, peer &apos;10.10.13.110:&apos;
161116 18:46:10 [Warning] WSREP: no nodes coming from prim view, prim not possible
161116 18:46:10 [Note] WSREP: view(view_id(NON_PRIM,e0f5cb2a,1) memb {
    e0f5cb2a,0
} joined {
} left {
} partitioned {
})
161116 18:46:10 [Warning] WSREP: last inactive check more than PT1.5S ago (PT3.50279S), skipping check
161116 18:46:40 [Note] WSREP: view((empty))
161116 18:46:40 [ERROR] WSREP: failed to open gcomm backend connection: 110: failed to reach primary view: 110 (Connection timed out)
     at gcomm/src/pc.cpp:connect():162
161116 18:46:40 [ERROR] WSREP: gcs/src/gcs_core.cpp:gcs_core_open():208: Failed to open backend connection: -110 (Connection timed out)
161116 18:46:40 [ERROR] WSREP: gcs/src/gcs.cpp:gcs_open():1380: Failed to open channel &apos;my_wsrep_cluster&apos; at &apos;gcomm://10.10.13.110&apos;: -110 (Connection timed out)
161116 18:46:40 [ERROR] WSREP: gcs connect failed: Connection timed out
161116 18:46:40 [ERROR] WSREP: wsrep::connect(gcomm://10.10.13.110) failed: 7
161116 18:46:40 [ERROR] Aborting

161116 18:46:40 [Note] WSREP: Service disconnected.
161116 18:46:41 [Note] WSREP: Some threads may fail to exit.
161116 18:46:41 [Note] mysqld: Shutdown complete

[tom@kube-node-13 galera]$
</code></pre><p>哈哈，看 <code>161116 18:46:07 [Note] WSREP: wsrep_load(): loading provider library &#39;/usr/lib/galera/libgalera_smm.so&#39;</code> 知道，这个错误，确实是跳过去了。<br>现在来找第一个 [Warning] 。找到了。<code>161116 18:46:07 [Warning] WSREP: Could not open state file for reading: &#39;/data/mariadb/mysql//grastate.dat&#39;</code><br>那看下，这个文件有没有？</p>
<pre><code>[tom@kube-node-13 galera]$ cd /data/mariadb/mysql
[tom@kube-node-13 mysql]$ ls -lZ
-rw-rw----. mysql mysql unconfined_u:object_r:mysqld_db_t:s0 aria_log.00000001
-rw-rw----. mysql mysql unconfined_u:object_r:mysqld_db_t:s0 aria_log_control
-rw-------. mysql mysql unconfined_u:object_r:mysqld_db_t:s0 galera.cache
-rw-rw----. mysql mysql unconfined_u:object_r:mysqld_db_t:s0 grastate.dat
-rw-rw----. mysql mysql unconfined_u:object_r:mysqld_db_t:s0 ibdata1
-rw-rw----. mysql mysql unconfined_u:object_r:mysqld_db_t:s0 ib_logfile0
-rw-rw----. mysql mysql unconfined_u:object_r:mysqld_db_t:s0 ib_logfile1
-rw-r-----. mysql root  unconfined_u:object_r:mysqld_db_t:s0 kube-node-13.err
-rw-rw----. mysql mysql unconfined_u:object_r:mysqld_db_t:s0 kube-node-13.pid
-rw-rw----. mysql mysql unconfined_u:object_r:mysqld_db_t:s0 multi-master.info
drwx--x--x. mysql mysql unconfined_u:object_r:mysqld_db_t:s0 mysql
drwx------. mysql mysql unconfined_u:object_r:mysqld_db_t:s0 performance_schema
-rw-rw-rw-. root  root  unconfined_u:object_r:mysqld_db_t:s0 slow_query_log.log
</code></pre><p>有<code>/data/mariadb/mysql//grastate.dat</code>呀。什么鬼？<br>不要手动启动了。用sudo service 启动一下。</p>
<pre><code>[tom@kube-node-13 mysql]$ sudo service mysql start
Starting MySQL SUCCESS!
[tom@kube-node-13 mysql]$ 161116 18:50:43 mysqld_safe Logging to &apos;/data/mariadb/mysql/kube-node-13.err&apos;.
^C
[tom@kube-node-13 mysql]$
</code></pre><p>好了，再把现有的 mysqld 关闭了去。</p>
<pre><code>[tom@kube-node-13 mysql]$ sudo service mysql stop
Shutting down MySQL161116 18:54:00 [Note] mysqld: Normal shutdown

.161116 18:54:00 [Note] WSREP: Stop replication
161116 18:54:00 [Note] Event Scheduler: Purging the queue. 0 events
161116 18:54:00 [Note] InnoDB: FTS optimize thread exiting.
161116 18:54:00 [Note] InnoDB: Starting shutdown...
161116 18:54:01 [Note] InnoDB: Waiting for page_cleaner to finish flushing of buffer pool
..161116 18:54:02 [Note] InnoDB: Shutdown completed; log sequence number 1624196
161116 18:54:02 [Note] mysqld: Shutdown complete

 SUCCESS!
[tom@kube-node-13 mysql]$ ps -ef | grep mysql
tom      15073 36010  0 18:54 pts/1    00:00:00 grep --color=auto mysql

[tom@kube-node-13 mysql]$ sudo service mysql start
Starting MySQL.161116 18:54:29 mysqld_safe Logging to &apos;/data/mariadb/mysql/kube-node-13.err&apos;.
..
................................ ERROR!
[tom@kube-node-13 mysql]$
</code></pre><p>有错误日志了。看去。</p>
<pre><code>[tom@kube-node-13 mysql]$ sudo cat /data/mariadb/mysql/kube-node-13.err
...
...
...
161116 18:19:18 [Note] WSREP: wsrep_load(): loading provider library &apos;none&apos;
161116 18:19:18 [Note] /usr/sbin/mysqld: ready for connections.
Version: &apos;10.0.28-MariaDB-wsrep&apos;  socket: &apos;/var/lib/mysql/mysql.sock&apos;  port: 3306  MariaDB Server, wsrep_25.16.rc3fc46e
161116 18:29:53 [Note] /usr/sbin/mysqld: Normal shutdown

161116 18:29:53 [Note] WSREP: Stop replication
161116 18:29:53 [Note] Event Scheduler: Purging the queue. 0 events
161116 18:29:53 [Note] InnoDB: FTS optimize thread exiting.
161116 18:29:53 [Note] InnoDB: Starting shutdown...
161116 18:29:54 [Note] InnoDB: Waiting for page_cleaner to finish flushing of buffer pool
161116 18:29:56 [Note] InnoDB: Shutdown completed; log sequence number 1624176
161116 18:29:56 [Note] /usr/sbin/mysqld: Shutdown complete

161116 18:29:56 mysqld_safe mysqld from pid file /data/mariadb/mysql/kube-node-13.pid ended
161116 18:54:29 mysqld_safe Starting mysqld daemon with databases from /data/mariadb/mysql
161116 18:54:29 mysqld_safe WSREP: Running position recovery with --log_error=&apos;/data/mariadb/mysql/wsrep_recovery.N6pzuB&apos; --pid-file=&apos;/data/mariadb/mysql/kube-node-13-recover.pid&apos;
161116 18:54:29 [Note] /usr/sbin/mysqld (mysqld 10.0.28-MariaDB-wsrep) starting as process 15313 ...
161116 18:54:32 mysqld_safe WSREP: Recovered position 00000000-0000-0000-0000-000000000000:-1
161116 18:54:32 [Note] /usr/sbin/mysqld (mysqld 10.0.28-MariaDB-wsrep) starting as process 15379 ...
161116 18:54:32 [Note] WSREP: Read nil XID from storage engines, skipping position init
161116 18:54:32 [Note] WSREP: wsrep_load(): loading provider library &apos;/usr/lib/galera/libgalera_smm.so&apos;
161116 18:54:32 [Note] WSREP: wsrep_load(): Galera 25.3.18(r3632) by Codership Oy &lt;info@codership.com&gt; loaded successfully.
161116 18:54:32 [Note] WSREP: CRC-32C: using hardware acceleration.
161116 18:54:32 [Note] WSREP: Found saved state: 00000000-0000-0000-0000-000000000000:-1
161116 18:54:32 [Note] WSREP: Passing config to GCS: base_dir = /data/mariadb/mysql/; base_host = 10.10.12.13; base_port = 4567; cert.log_conflicts = no; debug = no; evs.auto_evict = 0; evs.delay_margin = PT1S; evs.delayed_keep_period = PT30S; evs.inactive_check_period = PT0.5S; evs.inactive_timeout = PT15S; evs.join_retrans_period = PT1S; evs.max_install_timeouts = 3; evs.send_window = 4; evs.stats_report_period = PT1M; evs.suspect_timeout = PT5S; evs.user_send_window = 2; evs.view_forget_timeout = PT24H; gcache.dir = /data/mariadb/mysql/; gcache.keep_pages_size = 0; gcache.mem_size = 0; gcache.name = /data/mariadb/mysql//galera.cache; gcache.page_size = 128M; gcache.size = 128M; gcomm.thread_prio = ; gcs.fc_debug = 0; gcs.fc_factor = 1.0; gcs.fc_limit = 16; gcs.fc_master_slave = no; gcs.max_packet_size = 64500; gcs.max_throttle = 0.25; gcs.recv_q_hard_limit = 9223372036854775807; gcs.recv_q_soft_limit = 0.25; gcs.sync_donor = no; gmcast.segment = 0; gmcast.version = 0; pc.announce_timeout = PT3S; pc.checksum = false; pc.ignore_q
161116 18:54:32 [Note] WSREP: Service thread queue flushed.
161116 18:54:32 [Note] WSREP: Assign initial position for certification: -1, protocol version: -1
161116 18:54:32 [Note] WSREP: wsrep_sst_grab()
161116 18:54:32 [Note] WSREP: Start replication
161116 18:54:32 [Note] WSREP: Setting initial position to 00000000-0000-0000-0000-000000000000:-1
161116 18:54:32 [Note] WSREP: protonet asio version 0
161116 18:54:32 [Note] WSREP: Using CRC-32C for message checksums.
161116 18:54:32 [Note] WSREP: backend: asio
161116 18:54:32 [Note] WSREP: gcomm thread scheduling priority set to other:0
161116 18:54:32 [Warning] WSREP: access file(/data/mariadb/mysql//gvwstate.dat) failed(No such file or directory)
161116 18:54:32 [Note] WSREP: restore pc from disk failed
161116 18:54:32 [Note] WSREP: GMCast version 0
161116 18:54:32 [Note] WSREP: (0e6fea53, &apos;tcp://0.0.0.0:4567&apos;) listening at tcp://0.0.0.0:4567
161116 18:54:32 [Note] WSREP: (0e6fea53, &apos;tcp://0.0.0.0:4567&apos;) multicast: , ttl: 1
161116 18:54:32 [Note] WSREP: EVS version 0
161116 18:54:32 [Note] WSREP: gcomm: connecting to group &apos;my_wsrep_cluster&apos;, peer &apos;10.10.13.110:&apos;
161116 18:54:35 [Warning] WSREP: no nodes coming from prim view, prim not possible
161116 18:54:35 [Note] WSREP: view(view_id(NON_PRIM,0e6fea53,1) memb {
    0e6fea53,0
} joined {
} left {
} partitioned {
})
161116 18:54:36 [Warning] WSREP: last inactive check more than PT1.5S ago (PT3.50217S), skipping check
161116 18:55:05 [Note] WSREP: view((empty))
161116 18:55:05 [ERROR] WSREP: failed to open gcomm backend connection: 110: failed to reach primary view: 110 (Connection timed out)
     at gcomm/src/pc.cpp:connect():162
161116 18:55:05 [ERROR] WSREP: gcs/src/gcs_core.cpp:gcs_core_open():208: Failed to open backend connection: -110 (Connection timed out)
161116 18:55:05 [ERROR] WSREP: gcs/src/gcs.cpp:gcs_open():1380: Failed to open channel &apos;my_wsrep_cluster&apos; at &apos;gcomm://10.10.13.110&apos;: -110 (Connection timed out)
161116 18:55:05 [ERROR] WSREP: gcs connect failed: Connection timed out
161116 18:55:05 [ERROR] WSREP: wsrep::connect(gcomm://10.10.13.110) failed: 7
161116 18:55:05 [ERROR] Aborting

161116 18:55:05 [Note] WSREP: Service disconnected.
161116 18:55:06 [Note] WSREP: Some threads may fail to exit.
161116 18:55:06 [Note] /usr/sbin/mysqld: Shutdown complete

161116 18:55:06 mysqld_safe mysqld from pid file /data/mariadb/mysql/kube-node-13.pid ended
[tom@kube-node-13 mysql]$ date
2016年 11月 16日 星期三 18:55:16 CST
[tom@kube-node-13 mysql]$
</code></pre><p>嗯，确实是现在的日志。<br>来看一下。</p>
<pre><code>161116 18:54:32 [Warning] WSREP: access file(/data/mariadb/mysql//gvwstate.dat) failed(No such file or directory)
161116 18:54:32 [Note] WSREP: restore pc from disk failed
161116 18:54:32 [Note] WSREP: GMCast version 0
161116 18:54:32 [Note] WSREP: (0e6fea53, &apos;tcp://0.0.0.0:4567&apos;) listening at tcp://0.0.0.0:4567
161116 18:54:32 [Note] WSREP: (0e6fea53, &apos;tcp://0.0.0.0:4567&apos;) multicast: , ttl: 1
161116 18:54:32 [Note] WSREP: EVS version 0
161116 18:54:32 [Note] WSREP: gcomm: connecting to group &apos;my_wsrep_cluster&apos;, peer &apos;10.10.13.110:&apos;
</code></pre><p>哈。有问题呀。我们在配置文件中的 <code>wsrep_cluster_address=&quot;gcomm://10.10.13.110,192.168.31.240,10.10.12.13&quot;
wsrep_cluster_name=&#39;galera_cluster&#39;</code> 到这里怎么是这样的啦！！！</p>
<p>好吧。快回忆，是哪里配置过 <code>my_wsrep_cluster</code>.</p>
<p>想到了。<br>之前在 <code>/etc/my.cnf.d/wsrep.cnf</code> 里面配置过这个。</p>
<pre><code>[tom@kube-node-13 mysql]$ cd /etc/my.cnf.d/
[tom@kube-node-13 my.cnf.d]$ ls -la
total 40
drwxr-xr-x.   2 root root 4096 11月 16 19:09 .
drwxr-xr-x. 141 root root 8192 11月 16 16:45 ..
-rw-r--r--.   1 root root  295 10月 28 01:16 client.cnf
-rw-r--r--.   1 root root  232 10月 28 01:16 mysql-clients.cnf
-rw-r--r--.   1 root root 1772 11月 16 18:59 server.cnf
-rw-r--r--.   1 root root 1007 11月 16 14:10 server.cnf_original
-rw-r--r--.   1 root root  285 11月  3 09:14 tokudb.cnf
-rw-r--r--.   1 root root 3611 11月 16 15:10 wsrep.cnf
[tom@kube-node-13 my.cnf.d]$ vi wsrep.cnf
</code></pre><p>查了一下，里面确实就是有呀。哭了。原来是这个文件的<br>那把这个文件移出去，再试一下吧。</p>
<pre><code>[tom@kube-node-13 my.cnf.d]$ sudo mv wsrep.cnf ~/wsrep.cnf.bak
[tom@kube-node-13 my.cnf.d]$ ls
client.cnf  mysql-clients.cnf  server.cnf  server.cnf_original  tokudb.cnf
[tom@kube-node-13 my.cnf.d]$ sudo service mysql status
 ERROR! MySQL is not running, but lock file (/var/lock/subsys/mysql) exists
[tom@kube-node-13 my.cnf.d]$ sudo service mysql stop
 ERROR! MySQL server PID file could not be found!
[tom@kube-node-13 my.cnf.d]$ sudo service mysql start
Starting MySQL.161116 19:12:20 mysqld_safe Logging to &apos;/data/mariadb/mysql/kube-node-13.err&apos;.
............a...................... ERROR!
[tom@kube-node-13 my.cnf.d]$
</code></pre><p>崩溃，看日志。</p>
<pre><code>[tom@kube-node-13 my.cnf.d]$ sudo cat /data/mariadb/mysql/kube-node-13.err
...
...
...
161116 19:02:19 mysqld_safe mysqld from pid file /data/mariadb/mysql/kube-node-13.pid ended
161116 19:12:20 mysqld_safe Starting mysqld daemon with databases from /data/mariadb/mysql
161116 19:12:20 mysqld_safe WSREP: Running position recovery with --log_error=&apos;/data/mariadb/mysql/wsrep_recovery.3kyk74&apos; --pid-file=&apos;/data/mariadb/mysql/kube-node-13-recover.pid&apos;
161116 19:12:20 [Note] /usr/sbin/mysqld (mysqld 10.0.28-MariaDB-wsrep) starting as process 17474 ...
161116 19:12:23 mysqld_safe WSREP: Recovered position 00000000-0000-0000-0000-000000000000:-1
161116 19:12:23 [Note] /usr/sbin/mysqld (mysqld 10.0.28-MariaDB-wsrep) starting as process 17514 ...
161116 19:12:23 [Note] WSREP: Read nil XID from storage engines, skipping position init
161116 19:12:23 [Note] WSREP: wsrep_load(): loading provider library &apos;/usr/lib64/galera/libgalera_smm.so&apos;
161116 19:12:23 [Note] WSREP: wsrep_load(): Galera 25.3.18(r3632) by Codership Oy &lt;info@codership.com&gt; loaded successfully.
161116 19:12:23 [Note] WSREP: CRC-32C: using hardware acceleration.
161116 19:12:23 [Note] WSREP: Found saved state: 00000000-0000-0000-0000-000000000000:-1
161116 19:12:23 [Note] WSREP: Passing config to GCS: base_dir = /data/mariadb/mysql/; base_host = 10.10.12.13; base_port = 4567; cert.log_conflicts = no; debug = no; evs.auto_evict = 0; evs.delay_margin = PT1S; evs.delayed_keep_period = PT30S; evs.inactive_check_period = PT0.5S; evs.inactive_timeout = PT15S; evs.join_retrans_period = PT1S; evs.max_install_timeouts = 3; evs.send_window = 4; evs.stats_report_period = PT1M; evs.suspect_timeout = PT5S; evs.user_send_window = 2; evs.view_forget_timeout = PT24H; gcache.dir = /data/mariadb/mysql/; gcache.keep_pages_size = 0; gcache.mem_size = 0; gcache.name = /data/mariadb/mysql//galera.cache; gcache.page_size = 128M; gcache.size = 128M; gcomm.thread_prio = ; gcs.fc_debug = 0; gcs.fc_factor = 1.0; gcs.fc_limit = 16; gcs.fc_master_slave = no; gcs.max_packet_size = 64500; gcs.max_throttle = 0.25; gcs.recv_q_hard_limit = 9223372036854775807; gcs.recv_q_soft_limit = 0.25; gcs.sync_donor = no; gmcast.segment = 0; gmcast.version = 0; pc.announce_timeout = PT3S; pc.checksum = false; pc.ignore_q
161116 19:12:23 [Note] WSREP: Service thread queue flushed.
161116 19:12:23 [Note] WSREP: Assign initial position for certification: -1, protocol version: -1
161116 19:12:23 [Note] WSREP: wsrep_sst_grab()
161116 19:12:23 [Note] WSREP: Start replication
161116 19:12:23 [Note] WSREP: Setting initial position to 00000000-0000-0000-0000-000000000000:-1
161116 19:12:23 [Note] WSREP: protonet asio version 0
161116 19:12:23 [Note] WSREP: Using CRC-32C for message checksums.
161116 19:12:23 [Note] WSREP: backend: asio
161116 19:12:23 [Note] WSREP: gcomm thread scheduling priority set to other:0
161116 19:12:23 [Warning] WSREP: access file(/data/mariadb/mysql//gvwstate.dat) failed(No such file or directory)
161116 19:12:23 [Note] WSREP: restore pc from disk failed
161116 19:12:23 [Note] WSREP: GMCast version 0
161116 19:12:23 [Note] WSREP: (8c84d2c7, &apos;tcp://0.0.0.0:4567&apos;) listening at tcp://0.0.0.0:4567
161116 19:12:23 [Note] WSREP: (8c84d2c7, &apos;tcp://0.0.0.0:4567&apos;) multicast: , ttl: 1
161116 19:12:23 [Note] WSREP: EVS version 0
161116 19:12:23 [Note] WSREP: gcomm: connecting to group &apos;galera_cluster&apos;, peer &apos;10.10.12.13:,10.10.13.110:,192.168.31.240:&apos;
161116 19:12:23 [Note] WSREP: (8c84d2c7, &apos;tcp://0.0.0.0:4567&apos;) connection established to 8c84d2c7 tcp://10.10.12.13:4567
161116 19:12:23 [Warning] WSREP: (8c84d2c7, &apos;tcp://0.0.0.0:4567&apos;) address &apos;tcp://10.10.12.13:4567&apos; points to own listening address, blacklisting
161116 19:12:23 [Note] WSREP: (8c84d2c7, &apos;tcp://0.0.0.0:4567&apos;) connection established to 8c84d2c7 tcp://10.10.12.13:4567
161116 19:12:26 [Warning] WSREP: no nodes coming from prim view, prim not possible
161116 19:12:26 [Note] WSREP: view(view_id(NON_PRIM,8c84d2c7,1) memb {
    8c84d2c7,0
} joined {
} left {
} partitioned {
})
161116 19:12:26 [Warning] WSREP: last inactive check more than PT1.5S ago (PT3.50305S), skipping check
161116 19:12:56 [Note] WSREP: view((empty))
161116 19:12:56 [ERROR] WSREP: failed to open gcomm backend connection: 110: failed to reach primary view: 110 (Connection timed out)
     at gcomm/src/pc.cpp:connect():162
161116 19:12:56 [ERROR] WSREP: gcs/src/gcs_core.cpp:gcs_core_open():208: Failed to open backend connection: -110 (Connection timed out)
161116 19:12:56 [ERROR] WSREP: gcs/src/gcs.cpp:gcs_open():1380: Failed to open channel &apos;galera_cluster&apos; at &apos;gcomm://10.10.12.13,10.10.13.110,192.168.31.240&apos;: -110 (Connection timed out)
161116 19:12:56 [ERROR] WSREP: gcs connect failed: Connection timed out
161116 19:12:56 [ERROR] WSREP: wsrep::connect(gcomm://10.10.12.13,10.10.13.110,192.168.31.240) failed: 7
161116 19:12:56 [ERROR] Aborting

161116 19:12:56 [Note] WSREP: Service disconnected.
161116 19:12:57 [Note] WSREP: Some threads may fail to exit.
161116 19:12:57 [Note] /usr/sbin/mysqld: Shutdown complete

161116 19:12:57 mysqld_safe mysqld from pid file /data/mariadb/mysql/kube-node-13.pid ended
[tom@kube-node-13 my.cnf.d]$
</code></pre><p>好事情。<br><code>161116 19:12:23 [Note] WSREP: wsrep_load(): loading provider library &#39;/usr/lib64/galera/libgalera_smm.so&#39;</code><br><code>161116 19:12:23 [Note] WSREP: gcomm: connecting to group &#39;galera_cluster&#39;, peer &#39;10.10.12.13:,10.10.13.110:,192.168.31.240:&#39;</code><br><code>161116 19:12:23 [Note] WSREP: (8c84d2c7, &#39;tcp://0.0.0.0:4567&#39;) connection established to 8c84d2c7 tcp://10.10.12.13:4567</code><br>这几个关键的点，都正常了。</p>
<p>但是为什么还出错了呢。崩溃了吧。</p>
<p>清醒一下，让我想想，为什么？</p>
<p>叮咚。</p>
<p>明白了。刚刚是，只启动cluster的第一台机器，命令错了哈。应该用 <code>sudo /etc/init.d/mysql start --wsrep-new-cluster</code>，下回要注意呀。</p>
<pre><code>[tom@kube-node-13 my.cnf.d]$ sudo /etc/init.d/mysql start --wsrep-new-cluster
Starting MySQL.161116 19:17:28 mysqld_safe Logging to &apos;/data/mariadb/mysql/kube-node-13.err&apos;.
. SUCCESS!
[tom@kube-node-13 my.cnf.d]$ mysql -u root -p -e &quot;show status like &apos;wsrep%&apos;&quot;;
Enter password:
+------------------------------+---------------------------------------------+
| Variable_name                | Value                                       |
+------------------------------+---------------------------------------------+
| wsrep_local_state_uuid       | 440fe21c-abee-11e6-b1c1-9bfbe1e4335d        |
| wsrep_protocol_version       | 7                                           |
| wsrep_last_committed         | 0                                           |
| wsrep_replicated             | 0                                           |
| wsrep_replicated_bytes       | 0                                           |
| wsrep_repl_keys              | 0                                           |
| wsrep_repl_keys_bytes        | 0                                           |
| wsrep_repl_data_bytes        | 0                                           |
| wsrep_repl_other_bytes       | 0                                           |
| wsrep_received               | 2                                           |
| wsrep_received_bytes         | 138                                         |
| wsrep_local_commits          | 0                                           |
| wsrep_local_cert_failures    | 0                                           |
| wsrep_local_replays          | 0                                           |
| wsrep_local_send_queue       | 0                                           |
| wsrep_local_send_queue_max   | 1                                           |
| wsrep_local_send_queue_min   | 0                                           |
| wsrep_local_send_queue_avg   | 0.000000                                    |
| wsrep_local_recv_queue       | 0                                           |
| wsrep_local_recv_queue_max   | 2                                           |
| wsrep_local_recv_queue_min   | 0                                           |
| wsrep_local_recv_queue_avg   | 0.500000                                    |
| wsrep_local_cached_downto    | 18446744073709551615                        |
| wsrep_flow_control_paused_ns | 0                                           |
| wsrep_flow_control_paused    | 0.000000                                    |
| wsrep_flow_control_sent      | 0                                           |
| wsrep_flow_control_recv      | 0                                           |
| wsrep_cert_deps_distance     | 0.000000                                    |
| wsrep_apply_oooe             | 0.000000                                    |
| wsrep_apply_oool             | 0.000000                                    |
| wsrep_apply_window           | 0.000000                                    |
| wsrep_commit_oooe            | 0.000000                                    |
| wsrep_commit_oool            | 0.000000                                    |
| wsrep_commit_window          | 0.000000                                    |
| wsrep_local_state            | 4                                           |
| wsrep_local_state_comment    | Synced                                      |
| wsrep_cert_index_size        | 0                                           |
| wsrep_causal_reads           | 0                                           |
| wsrep_cert_interval          | 0.000000                                    |
| wsrep_incoming_addresses     | 10.10.12.13:3306                            |
| wsrep_desync_count           | 0                                           |
| wsrep_evs_delayed            |                                             |
| wsrep_evs_evict_list         |                                             |
| wsrep_evs_repl_latency       | 4.903e-06/9.301e-06/1.892e-05/5.26662e-06/5 |
| wsrep_evs_state              | OPERATIONAL                                 |
| wsrep_gcomm_uuid             | 440ea66b-abee-11e6-9185-f7b2a306dbf2        |
| wsrep_cluster_conf_id        | 1                                           |
| wsrep_cluster_size           | 1                                           |
| wsrep_cluster_state_uuid     | 440fe21c-abee-11e6-b1c1-9bfbe1e4335d        |
| wsrep_cluster_status         | Primary                                     |
| wsrep_connected              | ON                                          |
| wsrep_local_bf_aborts        | 0                                           |
| wsrep_local_index            | 0                                           |
| wsrep_provider_name          | Galera                                      |
| wsrep_provider_vendor        | Codership Oy &lt;info@codership.com&gt;           |
| wsrep_provider_version       | 25.3.18(r3632)                              |
| wsrep_ready                  | ON                                          |
| wsrep_thread_count           | 2                                           |
+------------------------------+---------------------------------------------+
[tom@kube-node-13 my.cnf.d]$
</code></pre><p>终于是成功了!<br>终于是成功了!<br>终于是成功了!</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://tomtsang.github.io/2016/11/17/markdown/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Tom Tsang">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.png">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="tomtsang">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="tomtsang" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/11/17/markdown/" itemprop="url">
                  markdown
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-11-17T14:19:03+08:00">
                2016-11-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/markdown/" itemprop="url" rel="index">
                    <span itemprop="name">markdown</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/11/17/markdown/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/11/17/markdown/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Markdown转HTML"><a href="#Markdown转HTML" class="headerlink" title="Markdown转HTML"></a>Markdown转HTML</h2><p>在线版：</p>
<ul>
<li><p><a href="http://www.zai17.com/md2html/" target="_blank" rel="external">在一起</a>（这个网站还有很多其实转换工具）<br>带了样式，但是不能用于 表格</p>
</li>
<li><p><a href="https://www.zybuluo.com/mdeditor#" target="_blank" rel="external">作业部落</a><br>不带样式，但是可用于 表格</p>
</li>
</ul>
<h2 id="HTML转Markdown"><a href="#HTML转Markdown" class="headerlink" title="HTML转Markdown"></a>HTML转Markdown</h2><p>在线版：</p>
<ul>
<li><a href="http://tool.lu/markdown/" target="_blank" rel="external">在线工具</a> （这个网站还有很多其实转换工具）<br>*</li>
</ul>
<h2 id="end"><a href="#end" class="headerlink" title="end"></a>end</h2>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://tomtsang.github.io/2016/11/15/mysql-2mysql系列之mysql_secure_installation/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Tom Tsang">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.png">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="tomtsang">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="tomtsang" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/11/15/mysql-2mysql系列之mysql_secure_installation/" itemprop="url">
                  mysql系列之mysql_secure_installation
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-11-15T18:31:35+08:00">
                2016-11-15
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/mysql/" itemprop="url" rel="index">
                    <span itemprop="name">mysql</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/11/15/mysql-2mysql系列之mysql_secure_installation/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/11/15/mysql-2mysql系列之mysql_secure_installation/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="http://www.myexception.cn/mysql/1902013.html" target="_blank" rel="external">http://www.myexception.cn/mysql/1902013.html</a></p>
<h2 id="过程"><a href="#过程" class="headerlink" title="过程"></a>过程</h2><p>安装完mysql-server 会提示可以运行mysql_secure_installation。<br>运行mysql_secure_installation会执行几个设置：<br>  a)为root用户设置密码<br>  b)删除匿名账号<br>  c)取消root用户远程登录<br>  d)删除test库和对test库的访问权限<br>  e)刷新授权表使修改生效<br>通过这几项的设置能够提高mysql库的安全。建议生产环境中mysql安装这完成后一定要运行一次mysql_secure_installation，详细步骤请参看下面的命令:</p>
<pre><code>[root@dns ~]# mysql_secure_installation
/usr/bin/mysql_secure_installation:行379: find_mysql_client: 未找到命令

NOTE: RUNNING ALL PARTS OF THIS SCRIPT IS RECOMMENDED FOR ALL MariaDB
      SERVERS IN PRODUCTION USE!  PLEASE READ EACH STEP CAREFULLY!

In order to log into MariaDB to secure it, we&apos;ll need the current
password for the root user.  If you&apos;ve just installed MariaDB, and
you haven&apos;t set the root password yet, the password will be blank,
so you should just press enter here.

ERROR 1045 (28000): Access denied for user &apos;root&apos;@&apos;localhost&apos; (using password: YES)
Enter current password for root (enter for none):   --&gt;初次运行直接enter
OK, successfully used password, moving on...

Setting the root password ensures that nobody can log into the MariaDB
root user without the proper authorisation.

Set root password? [Y/n] Y
New password:
Re-enter new password:
Password updated successfully!
Reloading privilege tables..
 ... Success!


By default, a MariaDB installation has an anonymous user, allowing anyone
to log into MariaDB without having to have a user account created for
them.  This is intended only for testing, and to make the installation
go a bit smoother.  You should remove them before moving into a
production environment.

Remove anonymous users? [Y/n] y
 ... Success!

Normally, root should only be allowed to connect from &apos;localhost&apos;.  This
ensures that someone cannot guess at the root password from the network.

Disallow root login remotely? [Y/n]
 ... Success!

By default, MariaDB comes with a database named &apos;test&apos; that anyone can
access.  This is also intended only for testing, and should be removed
before moving into a production environment.

Remove test database and access to it? [Y/n]
 - Dropping test database...
 ... Success!
 - Removing privileges on test database...
 ... Success!

Reloading the privilege tables will ensure that all changes made so far
will take effect immediately.

Reload privilege tables now? [Y/n]
 ... Success!

Cleaning up...

All done!  If you&apos;ve completed all of the above steps, your MariaDB
installation should now be secure.

Thanks for using MariaDB!
</code></pre>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/3/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/5/"><i class="fa fa-angle-right"></i></a>
  </nav>


          
          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.png"
               alt="Tom Tsang" />
          <p class="site-author-name" itemprop="name">Tom Tsang</p>
          <p class="site-description motion-element" itemprop="description">Tom Tsang's Blogs</p>
        </div>
        <nav class="site-state motion-element">
        
          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">53</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">14</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">14</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Tom Tsang</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.0"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"tomtsang"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    
    <script src="/lib/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  













  
  

  

  

  

  


</body>
</html>
